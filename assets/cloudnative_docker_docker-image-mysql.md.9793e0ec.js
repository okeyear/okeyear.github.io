import{_ as s,c as a,o as n,a as l}from"./app.cf0a218f.js";const F=JSON.parse('{"title":"docker常用镜像 mysql","description":"","frontmatter":{},"headers":[{"level":2,"title":"测试版","slug":"测试版","link":"#测试版","children":[]},{"level":2,"title":"实战版本(单机版本)","slug":"实战版本-单机版本","link":"#实战版本-单机版本","children":[]},{"level":2,"title":"实战版本(主从版本)","slug":"实战版本-主从版本","link":"#实战版本-主从版本","children":[]}],"relativePath":"cloudnative/docker/docker-image-mysql.md"}'),p={name:"cloudnative/docker/docker-image-mysql.md"},o=l(`<h1 id="docker常用镜像-mysql" tabindex="-1">docker常用镜像 mysql <a class="header-anchor" href="#docker常用镜像-mysql" aria-hidden="true">#</a></h1><p>网址: <a href="https://hub.docker.com/_/mysql" target="_blank" rel="noreferrer">https://hub.docker.com/_/mysql</a></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:TAG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--verbose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 命令行参数, 比如设置字符集等</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 当作Mysql客户端使用</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:TAG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-hIP</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uUser</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="测试版" tabindex="-1">测试版 <a class="header-anchor" href="#测试版" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">some-mysql</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=ChangeMe@</span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql root用户密码</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql:</span><span style="color:#F78C6C;">5.7</span></span>
<span class="line"></span></code></pre></div><p>测试版本问题</p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/charset-unicode-sets.html" target="_blank" rel="noreferrer">https://dev.mysql.com/doc/refman/5.7/en/charset-unicode-sets.html</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">1.</span><span style="color:#A6ACCD;"> 字符集 SHOW VARIABLES LIKE </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">character%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">2.</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">数据持久化</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">数据卷</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="实战版本-单机版本" tabindex="-1">实战版本(单机版本) <a class="header-anchor" href="#实战版本-单机版本" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Step 1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 新建my.cnf, 通过数据卷同步给mysql容器实例</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql/conf.d</span></span>
<span class="line"><span style="color:#FFCB6B;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql/conf.d/my.cnf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;-EOF</span></span>
<span class="line"><span style="color:#C3E88D;">[client]</span></span>
<span class="line"><span style="color:#C3E88D;">default-character-set=utf8</span></span>
<span class="line"><span style="color:#C3E88D;">[mysqld]</span></span>
<span class="line"><span style="color:#C3E88D;"># init_connect=&#39;SET collation_connection = utf8_unicode_ci&#39;</span></span>
<span class="line"><span style="color:#C3E88D;"># init_connect=&#39;SET NAMES utf8&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">character-set-server=utf8</span></span>
<span class="line"><span style="color:#C3E88D;">collation-server=utf8_unicode_ci</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 2</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 启动mysql实例, 查看字符编码</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">some-mysql</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3306</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3306</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># 主机端口不要冲突</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--restart=always</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--privileged=true</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql/log:/var/log/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql log 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql/data:/var/lib/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql 数据 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql/conf.d:/etc/mysql/conf.d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql 配置 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=ChangeMe@</span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql root用户密码</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">mysql:</span><span style="color:#F78C6C;">5.7</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果新建一个数据库并授权,可选使用如下方式</span></span>
<span class="line"><span style="color:#FFCB6B;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_DATABASE=zabbix</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e </span><span style="color:#C3E88D;">MYSQL_USER=zabbix</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">-e </span><span style="color:#C3E88D;">MYSQL_PASSWORD=zabbix</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 进入容器, 查看字符集</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">some-mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span></span>
<span class="line"><span style="color:#FFCB6B;">SHOW</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">VARIABLES</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">LIKE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">character%</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 建库,建表,测试中文utf8插入</span></span>
<span class="line"></span></code></pre></div><h2 id="实战版本-主从版本" tabindex="-1">实战版本(主从版本) <a class="header-anchor" href="#实战版本-主从版本" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">## Master 3307</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 1 新建Master实例</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-master01</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3307</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3306</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># 主机端口不要冲突</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--restart=always</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--privileged=true</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-master/log:/var/log/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql log 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-master/data:/var/lib/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql 数据 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-master/conf.d:/etc/mysql/conf.d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql 配置 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=ChangeMe@</span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql root用户密码</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">mysql:</span><span style="color:#F78C6C;">5.7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 2 Master实例的配置文件</span></span>
<span class="line"><span style="color:#FFCB6B;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-master/conf.d/my.cnf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;-EOF</span></span>
<span class="line"><span style="color:#C3E88D;">[client]</span></span>
<span class="line"><span style="color:#C3E88D;">default-character-set=utf8 # 字符集</span></span>
<span class="line"><span style="color:#C3E88D;">[mysqld]</span></span>
<span class="line"><span style="color:#C3E88D;">server_id=01 # 同一局域网内ID需要唯一</span></span>
<span class="line"><span style="color:#C3E88D;">binlog-ignore-db=mysql # 指定不需要同步的数据库</span></span>
<span class="line"><span style="color:#C3E88D;">log-bin=mall-mysql-bin # 开启二进制日志功能</span></span>
<span class="line"><span style="color:#C3E88D;">binlog_cache_size=10M # 二进制日志使用内存大小(事务)</span></span>
<span class="line"><span style="color:#C3E88D;">binlog_format=mixed # 设置使用的二进制日志格式 mixed statement row</span></span>
<span class="line"><span style="color:#C3E88D;">expire_logs_days=14 # 二进制日志过期清理时间, 默认值0,表示不自动清理</span></span>
<span class="line"><span style="color:#C3E88D;"># 跳过主从复制中遇到的错误或指定类型错误, 避免slave端复制中断 </span></span>
<span class="line"><span style="color:#C3E88D;"># 1062错误是指一些主键重复 1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span style="color:#C3E88D;">slave_skip_errors=1062 </span></span>
<span class="line"><span style="color:#C3E88D;">character-set-server=utf8 # 字符集</span></span>
<span class="line"><span style="color:#C3E88D;">collation-server=utf8_unicode_ci # 字符集</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 3 修改完重启master实例</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-master01</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 4 进入master容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-master01</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show master status</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 5 master数据库创建同步用的用户</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED BY &#39;abcd_123&#39;;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#39;slave&#39;@&#39;%&#39;;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SELECT Host,User FROM mysql.user;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## Slave 3308</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 6 新建Slave实例</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-slave01</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3308</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">3306</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># 主机端口不要冲突</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--restart=always</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">--privileged=true</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-slave/log:/var/log/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql log 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-slave/data:/var/lib/mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql 数据 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-v</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-slave/conf.d:/etc/mysql/conf.d</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql 配置 目录</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MYSQL_ROOT_PASSWORD=ChangeMe@</span><span style="color:#F78C6C;">123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#676E95;font-style:italic;"># mysql root用户密码</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">mysql:</span><span style="color:#F78C6C;">5.7</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># check</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 7 slave实例的配置文件</span></span>
<span class="line"><span style="color:#FFCB6B;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/data/mysql-slave/conf.d/my.cnf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;-EOF</span></span>
<span class="line"><span style="color:#C3E88D;">[client]</span></span>
<span class="line"><span style="color:#C3E88D;">default-character-set=utf8 # 字符集</span></span>
<span class="line"><span style="color:#C3E88D;">[mysqld]</span></span>
<span class="line"><span style="color:#C3E88D;">server_id=101 # 同一局域网内ID需要唯一</span></span>
<span class="line"><span style="color:#C3E88D;">binlog-ignore-db=mysql # 指定不需要同步的数据库</span></span>
<span class="line"><span style="color:#C3E88D;">log-bin=mall-mysql-slave01-bin # 开启二进制日志功能, 以备slave作为其他数据库实例的master时候使用</span></span>
<span class="line"><span style="color:#C3E88D;">binlog_cache_size=10M # 二进制日志使用内存大小(事务)</span></span>
<span class="line"><span style="color:#C3E88D;">binlog_format=mixed # 设置使用的二进制日志格式 mixed statement row</span></span>
<span class="line"><span style="color:#C3E88D;">expire_logs_days=14 # 二进制日志过期清理时间, 默认值0,表示不自动清理</span></span>
<span class="line"><span style="color:#C3E88D;"># 跳过主从复制中遇到的错误或指定类型错误, 避免slave端复制中断 </span></span>
<span class="line"><span style="color:#C3E88D;"># 1062错误是指一些主键重复 1032错误是因为主从数据库数据不一致</span></span>
<span class="line"><span style="color:#C3E88D;">slave_skip_errors=1062 </span></span>
<span class="line"><span style="color:#C3E88D;">relay_log=mall-mysql-relay-bin # relay_log配置中继日志</span></span>
<span class="line"><span style="color:#C3E88D;">log_slave_updates=1 # slave将复制事件日写进自己的二进制日志</span></span>
<span class="line"><span style="color:#C3E88D;">read_only=1 # slave设置为只读,具有super权限的用户除外</span></span>
<span class="line"><span style="color:#C3E88D;">character-set-server=utf8 # 字符集</span></span>
<span class="line"><span style="color:#C3E88D;">collation-server=utf8_unicode_ci # 字符集</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 8 修改完重启slave实例</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-slave01</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ps</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 9 进入slave容器</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-slave01</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 执行同步语句</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">change master to master_host=&#39;10.10.10.101&#39;,master_port=3307,master_user=&#39;slave&#39;,master_password=&#39;abcd_123&#39;,master_log_file=&#39;mall-mysql-bin.000001&#39; ,master_log_pos=154, master_connect_retry=30;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">   </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 执行前状态为No</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show slave status \\G;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Slave_.*_Running</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 执行</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">start slave;</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 执行后状态为Yes</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show slave status \\G;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Slave_.*_Running</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 10 进入master容器查看同步状态</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-master01</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show master status \\G;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show databases;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 11 master数据库写入测试</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 建库-使用库-建表-插入数据</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 官方测试数据库github网址：https://github.com/datacharmer/test_db</span></span>
<span class="line"><span style="color:#FFCB6B;">wget</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/datacharmer/test_db/releases/download/v1.</span><span style="color:#F78C6C;">0.7</span><span style="color:#C3E88D;">/test_db-1.0.7.tar.gz</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test_db-1.0.7.tar.gz</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-master01:/tmp/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-master01</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">employees.sql</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">employees_partitioned.sql</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-xf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test_db-1.0.7.tar.gz</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test_db</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">employees.sql</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">employees_partitioned.sql</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show databases;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 12 slave数据库读取测试</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 从机查看库,查看表,查询表记录</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">exec</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-it</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql-slave01</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">mysql</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-uroot</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-pChangeMe@123</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">show databases;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>`,12),e=[o];function t(c,r,C,y,D,A){return n(),a("div",null,e)}const E=s(p,[["render",t]]);export{F as __pageData,E as default};
