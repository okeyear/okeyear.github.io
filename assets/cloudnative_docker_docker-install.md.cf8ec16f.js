import{_ as s,c as n,o as a,a as l}from"./app.cf0a218f.js";const A=JSON.parse('{"title":"docker002 install 安装和配置","description":"","frontmatter":{},"headers":[{"level":2,"title":"安装docker","slug":"安装docker","link":"#安装docker","children":[{"level":3,"title":"docker官方脚本安装","slug":"docker官方脚本安装","link":"#docker官方脚本安装","children":[]},{"level":3,"title":"ubuntu安装","slug":"ubuntu安装","link":"#ubuntu安装","children":[]},{"level":3,"title":"centos安装","slug":"centos安装","link":"#centos安装","children":[]},{"level":3,"title":"开机自启动","slug":"开机自启动","link":"#开机自启动","children":[]}]},{"level":2,"title":"配置docker服务","slug":"配置docker服务","link":"#配置docker服务","children":[{"level":3,"title":"非特权运行","slug":"非特权运行","link":"#非特权运行","children":[]},{"level":3,"title":"默认配置文件","slug":"默认配置文件","link":"#默认配置文件","children":[]},{"level":3,"title":"修改DOCKER_OPTS","slug":"修改docker-opts","link":"#修改docker-opts","children":[]},{"level":3,"title":"镜像加速器","slug":"镜像加速器","link":"#镜像加速器","children":[]},{"level":3,"title":"配置docker cgroup驱动systemd","slug":"配置docker-cgroup驱动systemd","link":"#配置docker-cgroup驱动systemd","children":[]},{"level":3,"title":"配置docker proxy代理","slug":"配置docker-proxy代理","link":"#配置docker-proxy代理","children":[]},{"level":3,"title":"配置docker container使用的 proxy代理","slug":"配置docker-container使用的-proxy代理","link":"#配置docker-container使用的-proxy代理","children":[]},{"level":3,"title":"第一个镜像","slug":"第一个镜像","link":"#第一个镜像","children":[]}]}],"relativePath":"cloudnative/docker/docker-install.md"}'),o={name:"cloudnative/docker/docker-install.md"},p=l(`<h1 id="docker002-install-安装和配置" tabindex="-1">docker002 install 安装和配置 <a class="header-anchor" href="#docker002-install-安装和配置" aria-hidden="true">#</a></h1><p>官方文档: <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noreferrer">https://docs.docker.com/engine/install/</a></p><h2 id="安装docker" tabindex="-1">安装docker <a class="header-anchor" href="#安装docker" aria-hidden="true">#</a></h2><h3 id="docker官方脚本安装" tabindex="-1">docker官方脚本安装 <a class="header-anchor" href="#docker官方脚本安装" aria-hidden="true">#</a></h3><p><a href="https://github.com/okeyear/scripts/blob/main/shell/install_docker.sh" target="_blank" rel="noreferrer">https://github.com/okeyear/scripts/blob/main/shell/install_docker.sh</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-fsSL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get.docker.com</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-fsSL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get.docker.com</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get-docker.sh</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get-docker.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--mirror</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Aliyun</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># sudo sh get-docker.sh --mirror AzureChinaCloud</span></span>
<span class="line"></span></code></pre></div><h3 id="ubuntu安装" tabindex="-1">ubuntu安装 <a class="header-anchor" href="#ubuntu安装" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># delete old version</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">remove</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-engine</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker.io</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">runc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># step 1: 安装必要的一些系统工具</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">ca-certificates</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">curl</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">gnupg</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C3E88D;">lsb-release</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># step 2: 安装GPG证书</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/apt/keyrings</span></span>
<span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-fsSL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://download.docker.com/linux/ubuntu/gpg</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">gpg</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dearmor</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/apt/keyrings/docker.gpg</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 3: 写入软件源信息</span></span>
<span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">deb [arch=</span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">dpkg</span><span style="color:#C3E88D;"> --print-architecture</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">lsb_release</span><span style="color:#C3E88D;"> -cs</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;"> stable</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/apt/sources.list.d/docker.list</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/dev/null</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 4: 更新并安装Docker-CE</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt-get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce-cli</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerd.io</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-compose-plugin</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="centos安装" tabindex="-1">centos安装 <a class="header-anchor" href="#centos安装" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># https://download.docker.com/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># step 1: 安装必要的一些系统工具</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum-utils</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">device-mapper-persistent-data</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lvm2</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 2: 添加软件源信息</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># wget -O /etc/yum.repos.d/docker-ce.repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum-config-manager</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--add-repo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 3</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-i</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">s+download.docker.com+mirrors.aliyun.com/docker-ce+</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/yum.repos.d/docker-ce.repo</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 4: 更新并安装Docker-CE</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce-cli</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">containerd.io</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-compose-plugin</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-ce</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Step 4: 开启Docker服务</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--now</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># container-selinux</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># yum install -y http://mirror.centos.org/centos/7/extras/x86_64/Packages/container-selinux-2.119.2-1.911c772.el7_8.noarch.rpm</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># yum install -y http://mirror.centos.org/centos/7/extras/x86_64/Packages/slirp4netns-0.4.3-4.el7_8.x86_64.rpm</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># yum install -y http://mirror.centos.org/centos/7/extras/x86_64/Packages/fuse-overlayfs-0.7.2-6.el7_8.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 新版本会自动解决依赖, 不需要以下部分了</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># centos8需要额外的依赖containerd.io</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># firefox https://download.docker.com/linux/fedora/35/x86_64/stable/Packages</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># fedora/35/上的有问题， 继续使用fedora/31上面的最新版本</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># yum install https://download.docker.com/linux/fedora/35/x86_64/stable/Packages/containerd.io-1.4.12-3.1.fc35.x86_64.rpm</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># sudo yum install -y https://download.docker.com/linux/fedora/31/x86_64/stable/Packages/containerd.io-1.4.3-3.1.fc31.x86_64.rpm</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="开机自启动" tabindex="-1">开机自启动 <a class="header-anchor" href="#开机自启动" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is-enabled</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">version</span></span>
<span class="line"></span></code></pre></div><h2 id="配置docker服务" tabindex="-1">配置docker服务 <a class="header-anchor" href="#配置docker服务" aria-hidden="true">#</a></h2><h3 id="非特权运行" tabindex="-1">非特权运行 <a class="header-anchor" href="#非特权运行" aria-hidden="true">#</a></h3><p>把当前用户加入docker组</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">usermod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-aG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> $USER</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果已经sudo到root,请执行如下</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">usermod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-aG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> $SUDO_USER</span></span>
<span class="line"></span></code></pre></div><h3 id="默认配置文件" tabindex="-1">默认配置文件 <a class="header-anchor" href="#默认配置文件" aria-hidden="true">#</a></h3><p>Centos系统的配置 /etc/sysconfig/docker</p><p>Ubuntu系统的配置 /etc/default/docker</p><p>配置文件完整参考 <a href="https://docs.docker.com/engine/reference/commandline/dockerd/#options" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/dockerd/#options</a></p><h3 id="修改docker-opts" tabindex="-1">修改DOCKER_OPTS <a class="header-anchor" href="#修改docker-opts" aria-hidden="true">#</a></h3><ul><li>监听地址,允许本地2375端口接收远程连接 <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/dockerd/</a> 一般需要配合CA证书或者ssh隧道加密使用, 别直接暴漏2375端口</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">DOCKER_OPTS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">$DOCKER_OPTS</span><span style="color:#C3E88D;"> -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><ul><li>配置文件json则是:</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hosts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">unix:///var/run/docker.sock</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tcp://0.0.0.0:2375</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre></div><ul><li>非官方仓库的信任 编辑docker配置文件，加入</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">DOCKER_OPTS</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">--insecure-registry dl.dockerpool.com:5000</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre></div><h3 id="镜像加速器" tabindex="-1">镜像加速器 <a class="header-anchor" href="#镜像加速器" aria-hidden="true">#</a></h3><p>docker官方中国区 <a href="https://registry.docker-cn.com/" target="_blank" rel="noreferrer">https://registry.docker-cn.com</a></p><p>网易 <a href="http://hub-mirror.c.163.com/" target="_blank" rel="noreferrer">http://hub-mirror.c.163.com</a></p><p>ustc <a href="http://docker.mirrors.ustc.edu.cn/" target="_blank" rel="noreferrer">http://docker.mirrors.ustc.edu.cn</a></p><p>阿里云 http://&lt;你的ID&gt;.mirror.aliyuncs.com</p><ul><li><p>官方 &quot;<a href="https://registry.docker-cn.com%26quot%3B/" target="_blank" rel="noreferrer">https://registry.docker-cn.com&quot;</a></p></li><li><p>阿里云 容器镜像服务--镜像中心--镜像加速器 <a href="https://xc8hlpxv.mirror.aliyuncs.com/" target="_blank" rel="noreferrer">https://xc8hlpxv.mirror.aliyuncs.com</a></p></li></ul><p>您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">usermod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-aG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> $USER </span><span style="color:#676E95;font-style:italic;"># $SUDO_USER</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">usermod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-aG</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> $SUDO_USER</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">666</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/run/docker.sock</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/docker</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/docker/daemon.json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;-</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">EOF</span><span style="color:#C3E88D;">&#39;</span></span>
<span class="line"><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;registry-mirrors&quot;: [</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;http://hub-mirror.c.163.com&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;https://registry.docker-cn.com&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;https://xc8hlpxv.mirror.aliyuncs.com&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;http://f1361db2.m.daocloud.io&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">  ],</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;max-concurrent-downloads&quot;: 10,</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;max-concurrent-uploads&quot;: 5,</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;log-driver&quot;: &quot;json-file&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;log-opts&quot;: {</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;max-size&quot;: &quot;300m&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">    &quot;max-file&quot;: &quot;2&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">  },</span></span>
<span class="line"><span style="color:#C3E88D;">  &quot;live-restore&quot;: true</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">daemon-reload</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--now</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看配置的加速器生效</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">info</span></span>
<span class="line"></span></code></pre></div><ul><li>daocloud <a href="https://www.daocloud.io/mirror" target="_blank" rel="noreferrer">https://www.daocloud.io/mirror</a></li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-sSL</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://get.daocloud.io/daotools/set_mirror.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">http://f1361db2.m.daocloud.io</span></span>
<span class="line"></span></code></pre></div><p>该脚本可以将 --registry-mirror 加入到你的 Docker 配置文件 /etc/docker/daemon.json 中。适用于 Ubuntu14.04、Debian、CentOS6 、CentOS7、Fedora、Arch Linux、openSUSE Leap 42.1</p><h3 id="配置docker-cgroup驱动systemd" tabindex="-1">配置docker cgroup驱动systemd <a class="header-anchor" href="#配置docker-cgroup驱动systemd" aria-hidden="true">#</a></h3><p>关于cgroup驱动，参考 <a href="https://docs.docker.com/engine/reference/commandline/dockerd/" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/dockerd/</a></p><ul><li>cgroup v1 <code>sudo grubby --update-kernel=ALL --args=&quot;systemd.unified_cgroup_hierarchy=0&quot;</code></li><li>cgroup v2 <code>sudo grubby --update-kernel=ALL --args=&quot;systemd.unified_cgroup_hierarchy=1&quot;</code></li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">info</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Cgroup</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 1. /etc/docker/daemon.json</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">exec-opts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">native.cgroupdriver=systemd</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2.</span></span>
<span class="line"><span style="color:#FFCB6B;">/usr/lib/systemd/system/docker.service</span></span>
<span class="line"><span style="color:#A6ACCD;">ExecStart</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/bin/dockerd</span><span style="color:#A6ACCD;"> -H fd:// --containerd</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/run/containerd/containerd.sock</span><span style="color:#A6ACCD;"> --exec-opt native.cgroupdriver</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">systemd</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">daemon-reload</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span></code></pre></div><h3 id="配置docker-proxy代理" tabindex="-1">配置docker proxy代理 <a class="header-anchor" href="#配置docker-proxy代理" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">HTTP_PROXY</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">http://6.86.3.12:</span><span style="color:#F78C6C;">3128</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># HTTP_PROXY=http://172.17.1.250:3128</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/systemd/system/docker.service.d</span></span>
<span class="line"><span style="color:#FFCB6B;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/systemd/system/docker.service.d/http-proxy.conf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;EOF</span></span>
<span class="line"><span style="color:#C3E88D;">[Service]</span></span>
<span class="line"><span style="color:#C3E88D;">Environment=&quot;HTTP_PROXY=</span><span style="color:#A6ACCD;">$HTTP_PROXY</span><span style="color:#C3E88D;">&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">Environment=&quot;HTTPS_PROXY=</span><span style="color:#A6ACCD;">$HTTP_PROXY</span><span style="color:#C3E88D;">&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">Environment=&quot;NO_PROXY=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.0/8,6.86.0.0/16&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">daemon-reload</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 验证配置</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">show</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--property</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Environment</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 重启docker</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h3 id="配置docker-container使用的-proxy代理" tabindex="-1">配置docker container使用的 proxy代理 <a class="header-anchor" href="#配置docker-container使用的-proxy代理" aria-hidden="true">#</a></h3><p><a href="https://docs.docker.com/network/proxy/" target="_blank" rel="noreferrer">https://docs.docker.com/network/proxy/</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">container</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HTTP_PROXY=http://username:password@proxy2.domain.com</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">HTTPS_PROXY=http://username:password@proxy2.domain.com</span><span style="color:#A6ACCD;"> \\</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">myimage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 2</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/.docker</span></span>
<span class="line"><span style="color:#FFCB6B;">tee</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">~/.docker/config.json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;EOF</span></span>
<span class="line"><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#C3E88D;"> &quot;proxies&quot;:</span></span>
<span class="line"><span style="color:#C3E88D;"> {</span></span>
<span class="line"><span style="color:#C3E88D;">   &quot;default&quot;:</span></span>
<span class="line"><span style="color:#C3E88D;">   {</span></span>
<span class="line"><span style="color:#C3E88D;">     &quot;httpProxy&quot;: &quot;http://6.86.3.12:3128&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">     &quot;httpsProxy&quot;: &quot;http://6.86.3.12:3128&quot;,</span></span>
<span class="line"><span style="color:#C3E88D;">     &quot;noProxy&quot;: &quot;10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.0/8,6.86.0.0/16&quot;</span></span>
<span class="line"><span style="color:#C3E88D;">   }</span></span>
<span class="line"><span style="color:#C3E88D;"> }</span></span>
<span class="line"><span style="color:#C3E88D;">}</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"></span></code></pre></div><h3 id="第一个镜像" tabindex="-1">第一个镜像 <a class="header-anchor" href="#第一个镜像" aria-hidden="true">#</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">hello-world</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>`,49),e=[p];function t(c,r,y,C,i,d){return a(),n("div",null,e)}const u=s(o,[["render",t]]);export{A as __pageData,u as default};
