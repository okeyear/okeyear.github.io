import{_ as s,o as a,c as n,R as l}from"./chunks/framework.0a8b4614.js";const d=JSON.parse('{"title":"docker003 image 镜像","description":"","frontmatter":{},"headers":[],"relativePath":"cloudnative/docker/docker-image.md","filePath":"cloudnative/docker/docker-image.md","lastUpdated":1687344148000}'),o={name:"cloudnative/docker/docker-image.md"},p=l(`<h1 id="docker003-image-镜像" tabindex="-1">docker003 image 镜像 <a class="header-anchor" href="#docker003-image-镜像" aria-label="Permalink to &quot;docker003 image 镜像&quot;">​</a></h1><p>每一层的唯一id包括156比特, 由64个十六进制字符组成</p><p>常用技巧 指令 docker p383</p><h3 id="删" tabindex="-1">删 <a class="header-anchor" href="#删" aria-label="Permalink to &quot;删&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">image</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;">d</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">image_id</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">myubuntu:latest</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果有多个标签,只是删除了一个标签</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 只有一个标签时候,就彻底删除了镜像</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 注意：在删除镜像之前要先用 docker rm 删掉依赖于这个镜像的所有容器</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 虚悬镜像 dangling image</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 清理所有未打过标签的本地镜像 虚悬镜像</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># docker pull或者docker image导致标签被新的镜像拿走， 老的镜像既没有仓库名，也没有标签名；</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">image</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">prune</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 删除所有虚悬镜像 方式1 </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 删除所有虚悬镜像 方式2</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> images -q -f </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dangling=true</span><span style="color:#89DDFF;">&quot;)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 其中 -q 和 -f 是缩写, 完整的命令其实可以写着下面这样，是不是更容易理解一点？</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rmi</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">docker</span><span style="color:#C3E88D;"> images --quiet --filter </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dangling=true</span><span style="color:#89DDFF;">&quot;)</span></span></code></pre></div><h3 id="查" tabindex="-1">查 <a class="header-anchor" href="#查" aria-label="Permalink to &quot;查&quot;">​</a></h3><p><a href="https://docs.docker.com/engine/reference/commandline/search/" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/search/</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">imagess</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tomcat</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ls</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查image id</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">images</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-q</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看详细信息</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">inspect</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">image_nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看镜像制作历程</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">image_nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如何查看镜像支持的环境变量</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">IMAGE</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">env</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 搜索 search </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -f stars=N 替代 --stars</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># --limit N  只列出N个镜像, 默认25个</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--help</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#FFCB6B;">dockert</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">info</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">search</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--filter</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stars=</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">busybox</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 星数不少于3的镜像</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看所有 镜像 容器 数据卷 所占用的空间</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">system</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">df</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span></span></code></pre></div><h3 id="导入-导出镜像" tabindex="-1">导入/导出镜像 <a class="header-anchor" href="#导入-导出镜像" aria-label="Permalink to &quot;导入/导出镜像&quot;">​</a></h3><p>Docker image export with tag: <a href="https://github.com/okeyear/scripts/blob/main/shell/docker-images-export.sh" target="_blank" rel="noreferrer">https://github.com/okeyear/scripts/blob/main/shell/docker-images-export.sh</a></p><ul><li>导出镜像</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">save</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu_14.04.tar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu:14.04</span></span></code></pre></div><ul><li>导入镜像</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--input</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu_14.04.tar</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">load</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu_14.04.tar</span></span></code></pre></div><h3 id="获取镜像pull" tabindex="-1">获取镜像pull <a class="header-anchor" href="#获取镜像pull" aria-label="Permalink to &quot;获取镜像pull&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 语法</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> [option] </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">registry.hub.docker.com</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">:port</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">/</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">NAME</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">:TAG</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果TAG不指定,默认是latest</span></span></code></pre></div><h3 id="推送镜像push" tabindex="-1">推送镜像push <a class="header-anchor" href="#推送镜像push" aria-label="Permalink to &quot;推送镜像push&quot;">​</a></h3><p>上传镜像</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">push</span><span style="color:#A6ACCD;"> [OPTIONS] NAME</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">:TAG</span><span style="color:#89DDFF;">]</span></span></code></pre></div><h2 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-label="Permalink to &quot;其他&quot;">​</a></h2><h3 id="常用基础镜像" tabindex="-1">常用基础镜像 <a class="header-anchor" href="#常用基础镜像" aria-label="Permalink to &quot;常用基础镜像&quot;">​</a></h3><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#FFCB6B;">centos:7,almalinux</span><span style="color:#A6ACCD;">{,:minimal}</span><span style="color:#FFCB6B;">,alpine}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># debian:{9,10,11},ubuntu:{20,22}.04,oraclelinux,</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">do</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pull</span><span style="color:#A6ACCD;"> $i</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">done</span></span></code></pre></div><h3 id="ss镜像" tabindex="-1">ss镜像 <a class="header-anchor" href="#ss镜像" aria-label="Permalink to &quot;ss镜像&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-dt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ss</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8989</span><span style="color:#C3E88D;">:8989</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mritd/shadowsocks</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">-s 0.0.0.0 -p 8989 -m aes-256-gcm -k yourpassword  --fast-open</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h3 id="常用镜像相关命令" tabindex="-1">常用镜像相关命令 <a class="header-anchor" href="#常用镜像相关命令" aria-label="Permalink to &quot;常用镜像相关命令&quot;">​</a></h3><ul><li>对镜像添加标签</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tag</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mybuntu:latest</span></span></code></pre></div><ul><li><p>(从容器)创建镜像 <a href="https://docs.docker.com/engine/reference/commandline/commit/" target="_blank" rel="noreferrer">https://docs.docker.com/engine/reference/commandline/commit/</a></p></li><li><p>(从本地模板/openvz模板导入)创建镜像 <a href="https://wiki.openvz.org/Download/template/precreated" target="_blank" rel="noreferrer">https://wiki.openvz.org/Download/template/precreated</a></p></li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu-14.04-x86_64-minimal.tar.gz</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ubuntu:14.04</span></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos7.tar</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">import</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos:7</span></span>
<span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos-6-x86_64-minimal.tar.gz</span><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos:6</span></span></code></pre></div>`,29),e=[p];function t(c,r,C,i,y,D){return a(),n("div",null,e)}const h=s(o,[["render",t]]);export{d as __pageData,h as default};
