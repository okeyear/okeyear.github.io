<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>docker005 registry 仓库 | Hello World</title>
    <meta name="description" content="okeyear blog">
    <link rel="stylesheet" href="/assets/style.d8cc85cb.css">
    <link rel="modulepreload" href="/assets/chunks/AlgoliaSearchBox.c6c06635.js">
    <link rel="modulepreload" href="/assets/app.3a9754ab.js">
    <link rel="modulepreload" href="/assets/cloudnative_docker_docker-registry.md.30c460a6.lean.js">
    
    <meta name="twitter:title" content="docker005 registry 仓库 | Hello World">
  <meta property="og:title" content="docker005 registry 仓库 | Hello World">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/" aria-label="Hello World, back to home" data-v-675d8756 data-v-cc01ef16><!----> Hello World</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Linux</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/distro/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Distro</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/command/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Command</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/rootfs/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>RootFS</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/service/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Service</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>CloudNative</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/cloudnative/docker/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Docker</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/cloudnative/k8s/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>K8S</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/cloudnative/vmware/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>VMWare</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/cloudnative/terraform/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Terraform</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/windows/" data-v-b8818f8c>Windows <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/netwok/" data-v-b8818f8c>Netwok <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/shell/" data-v-b8818f8c>Shell <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/powershell/" data-v-b8818f8c>PowerShell <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Python</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/python/base/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Base</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/python/module/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Module</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Web</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/html/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>HTML</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/css/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>CSS</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/javascript/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>JavaScript</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/es6/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>ES6</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/typescript/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>TypeScript</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/vue/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Vue</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vscode/" data-v-b8818f8c>VSCode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Game</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/game/poe/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>POE</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/game/d3/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>D3</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/game/ahk/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>AHK</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/about/" data-v-b8818f8c>About <!----></a></div></div><!--]--><!----><!----></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/" data-v-b8818f8c>Home <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Linux</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/distro/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Distro</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/command/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Command</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/rootfs/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>RootFS</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/linux/service/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Service</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>CloudNative</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/cloudnative/docker/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Docker</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/cloudnative/k8s/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>K8S</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/cloudnative/vmware/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>VMWare</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/cloudnative/terraform/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Terraform</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/windows/" data-v-b8818f8c>Windows <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/netwok/" data-v-b8818f8c>Netwok <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/shell/" data-v-b8818f8c>Shell <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/powershell/" data-v-b8818f8c>PowerShell <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Python</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/python/base/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Base</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/python/module/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Module</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Web</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/html/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>HTML</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/css/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>CSS</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/javascript/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>JavaScript</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/es6/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>ES6</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/typescript/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>TypeScript</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/web/vue/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Vue</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/vscode/" data-v-b8818f8c>VSCode <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Game</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/game/poe/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>POE</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/game/d3/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>D3</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/game/ahk/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>AHK</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item" href="/about/" data-v-b8818f8c>About <!----></a></div></div><!--]--><!----><!----></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="#搭建私有仓库">搭建私有仓库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#上传镜像到私有仓库">上传镜像到私有仓库</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#从私有仓库下载镜像">从私有仓库下载镜像</a><!----></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="docker005-registry-仓库" tabindex="-1">docker005 registry 仓库 <a class="header-anchor" href="#docker005-registry-仓库" aria-hidden="true">#</a></h1><p>官方文档: <a href="https://docs.docker.com/registry/configuration/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/registry/configuration/</a></p><h2 id="搭建私有仓库" tabindex="-1">搭建私有仓库 <a class="header-anchor" href="#搭建私有仓库" aria-hidden="true">#</a></h2><p>从官方提供的registry镜像简单搭建一套本地私有仓库.</p><div class="language-bash"><pre><code><span class="token comment"># Step 1: 搭建仓库</span>
<span class="token comment"># mkdir -pv /opt/data/registry # 没有的目录, docker会创建</span>
<span class="token function">docker</span> run -d -p <span class="token number">5000</span>:5000 <span class="token punctuation">\</span>
    --restart<span class="token operator">=</span>always <span class="token punctuation">\</span>
    --privileged<span class="token operator">=</span>true <span class="token punctuation">\</span>
    -v /data/registry:/var/lib/registry <span class="token punctuation">\</span>
    --name<span class="token operator">=</span><span class="token string">&#39;registry&#39;</span> <span class="token punctuation">\</span>
    registry:2

<span class="token comment"># 参数说明:</span>
<span class="token comment"># -v /opt/data/registry:/tmp/registry </span>
<span class="token comment">#     默认情况下，会将仓库存放于容器内的/tmp/registry目录下，指定本地目录挂载到容器</span>
<span class="token comment"># --privileged=true</span>
<span class="token comment">#     CentOS7中的安全模块selinux把权限禁掉了，参数给容器加特权，</span>
<span class="token comment">#     不加上传镜像会报权限错误(OSError: [Errno 13] Permission denied: ‘/tmp/registry/repositories/liibrary’)</span>
<span class="token comment">#     或者（Received unexpected HTTP status: 500 Internal Server Error）错误</span>
</code></pre></div><h2 id="上传镜像到私有仓库" tabindex="-1">上传镜像到私有仓库 <a class="header-anchor" href="#上传镜像到私有仓库" aria-hidden="true">#</a></h2><p><a href="https://docs.docker.com/engine/reference/commandline/commit/" target="_blank" rel="noopener noreferrer">https://docs.docker.com/engine/reference/commandline/commit/</a></p><div class="language-bash"><pre><code><span class="token assign-left variable">registry_ip</span><span class="token operator">=</span><span class="token string">&#39;10.10.10.101&#39;</span>
<span class="token comment"># Step 2:</span>
<span class="token comment"># 对镜像做一些修改</span>
<span class="token function">docker</span> run -it ubuntu <span class="token function">bash</span>
<span class="token comment"># 修改国内源,装vim net-tools等</span>

<span class="token comment"># Step 3: </span>
<span class="token comment"># docker commit 镜像</span>
<span class="token function">docker</span> commit -m<span class="token operator">=</span><span class="token string">&quot;add mirrors, install vim net-tools&quot;</span> -a<span class="token operator">=</span><span class="token string">&#39;okeyear@163.com&#39;</span> 2263bed44655 myubuntu:1.0
<span class="token function">docker</span> images
<span class="token comment"># docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span>
<span class="token comment"># OPTIONS说明：</span>
<span class="token comment">#     -a :提交的镜像作者；</span>
<span class="token comment">#     -c :提交时候执行的Dockerfile指令；</span>
<span class="token comment">#     -m :提交时的说明文字；</span>
<span class="token comment">#     -p :在commit时，将容器暂停。</span>


<span class="token comment"># Step 4: </span>
<span class="token comment"># tag标记, 修改成符合私服规范的tag;   </span>
<span class="token comment"># 如果已经打了tag, 可省略</span>
<span class="token comment"># docker tag IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</span>
<span class="token function">docker</span> tag myubuntu:1.0 <span class="token variable">${registry_ip}</span>:5000/myubuntu:1.0

<span class="token comment"># Step 5: </span>
<span class="token comment"># 修改docker配置文件/etc/docker/daemon.json, 允许http方式传输</span>
<span class="token comment"># 因为是json格式, 这个粘贴进去之后,注意前后是否要加逗号</span>
<span class="token comment"># &quot;insecure-registries&quot;: [&quot;${registry_ip}:5000&quot;] ,</span>
<span class="token comment">#	&quot;insecure-registries&quot;: [</span>
<span class="token comment">#		&quot;10.10.10.10:5000&quot;</span>
<span class="token comment">#	]</span>
    
<span class="token function">service</span> <span class="token function">docker</span> restart

<span class="token comment"># Step 6: </span>
<span class="token comment"># 上传前查看</span>
<span class="token function">curl</span> -XGET http://<span class="token variable">${registry_ip}</span>:5000/v2/_catalog
<span class="token comment"># push上传</span>
<span class="token function">docker</span> push <span class="token variable">${registry_ip}</span>:5000/myubuntu:1.0
<span class="token comment"># 上传后查看</span>
<span class="token function">curl</span> -XGET http://<span class="token variable">${registry_ip}</span>:5000/v2/_catalog
<span class="token comment"># 查看所有的image和tag</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -XGET http://$<span class="token punctuation">{</span>registry_ip<span class="token punctuation">}</span>:5000/v2/_catalog <span class="token operator">|</span> jq <span class="token string">&#39;.repositories[] | tostring&#39;</span><span class="token variable">)</span></span>
<span class="token keyword">do</span> 
    <span class="token function">curl</span> -s -XGET http://<span class="token variable">${registry_ip}</span>:5000/v2/<span class="token variable">${i<span class="token operator">/</span><span class="token operator">/</span>\&quot;<span class="token operator">/</span>}</span>/tags/list
<span class="token keyword">done</span>
</code></pre></div><h2 id="从私有仓库下载镜像" tabindex="-1">从私有仓库下载镜像 <a class="header-anchor" href="#从私有仓库下载镜像" aria-hidden="true">#</a></h2><div class="language-bash"><pre><code>
<span class="token comment"># Step 7: </span>
<span class="token comment"># pull下载, 在其他地方使用</span>
<span class="token comment"># 需要在/etc/docker/daemon.json中registry-mirrors配置私有仓库地址</span>
<span class="token comment"># 先删除本地的images</span>
<span class="token function">docker</span> rmi <span class="token variable">${registry_ip}</span>:5000/myubuntu:1.0 myubuntu:1.0
<span class="token comment"># 从仓库pull一个</span>
<span class="token function">docker</span> pull <span class="token variable">${registry_ip}</span>:5000/myubuntu:1.0
<span class="token function">docker</span> images
</code></pre></div></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><!----></div></div><div class="updated" data-v-07c132fc><!----></div></footer><!----><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"cloudnative_docker_docker-dockerfile.md\":\"4278300a\",\"cloudnative_docker_docker-compose.md\":\"b71d19c3\",\"cloudnative_docker_docker-container.md\":\"8da5f169\",\"cloudnative_docker_docker-image-mysql.md\":\"a8935afb\",\"cloudnative_docker_docker-image-tomcat.md\":\"db561da6\",\"cloudnative_docker_docker-image.md\":\"94ac0af2\",\"cloudnative_docker_docker-install.md\":\"6cba41c5\",\"cloudnative_docker_docker-registry.md\":\"30c460a6\",\"cloudnative_docker_docker-volume.md\":\"f6d0a382\",\"cloudnative_docker_index.md\":\"7f785a3c\",\"cloudnative_k8s_index.md\":\"904ed499\",\"cloudnative_terraform_index.md\":\"74416ce6\",\"cloudnative_vmware_index.md\":\"3e2e4def\",\"game_ahk_index.md\":\"d5284f33\",\"game_d3_index.md\":\"f49487ff\",\"game_poe_index.md\":\"adc1cc54\",\"guide_index.md\":\"b6832392\",\"index.md\":\"23208123\",\"linux_command_index.md\":\"315bc2aa\",\"linux_command_jjj_join.md\":\"487602fe\",\"linux_command_nnn_nc.md\":\"bfc30317\",\"linux_distro_alpine_alpine-install.md\":\"74e69fa2\",\"linux_distro_alpine_index.md\":\"0d5881e1\",\"linux_distro_index.md\":\"9c21d59a\",\"linux_index.md\":\"51ba410d\",\"linux_rootfs_index.md\":\"e7a60d3f\",\"linux_service_ggg_gitlab-ce-install.md\":\"42bd0706\",\"linux_service_index.md\":\"de40cacf\",\"linux_service_sss_ssh-tunnel.md\":\"6fb68b79\",\"linux_service_sss_ssh.md\":\"422b4dbf\",\"network_index.md\":\"c9153ddb\",\"powershell_index.md\":\"db266a44\",\"python_base_index.md\":\"114dc00b\",\"python_index.md\":\"ef4041b4\",\"python_module_index.md\":\"2bcf8cac\",\"shell_index.md\":\"9b726a41\",\"vscode_index.md\":\"b8957a73\",\"web_css_index.md\":\"5f4a57a9\",\"web_es6_index.md\":\"aae7a337\",\"web_html_index.md\":\"e1a81082\",\"web_index.md\":\"8d52b991\",\"web_javascript_index.md\":\"38cdf7cc\",\"web_typescript_index.md\":\"be909522\",\"web_vue_index.md\":\"73dff249\",\"windows_index.md\":\"4d35f366\",\"windows_software.md\":\"0a4ddb94\"}")</script>
    <script type="module" async src="/assets/app.3a9754ab.js"></script>
    
  </body>
</html>